# PRD-002: MVP (v0.1)

**Depends on:** [001-vision.md](./001-vision.md)

## Scope

The minimum viable product: create, render, edit, execute, list, and delete workspaces.

## Commands

All commands are global ‚Äî run from anywhere.

| Command | Description |
|---------|-------------|
| `flow init [name]` | Create new empty workspace |
| `flow list` | List all workspaces |
| `flow render <name>` | Create worktrees from state file |
| `flow state <name>` | Open state file in editor |
| `flow exec <name> -- <cmd>` | Run command from workspace directory |
| `flow delete <name>` | Delete workspace |

---

### `flow init [name]`

Create a new empty workspace. No prompts ‚Äî instant.

**Behavior:**
1. Generate a random name (adjective-noun, e.g. `calm-delta`) or use the provided name
2. Create workspace directory at `~/.flow/workspaces/<name>/`
3. Write empty `state.yaml` (no repos)
4. Print success message with next steps

**Output:**
```
‚úì Created workspace calm-delta

  Next: flow state calm-delta
```

With `--name`:
```
‚úì Created workspace calm-delta (my-project)

  Next: flow state my-project
```

---

### `flow list`

List all workspaces.

**Behavior:**
1. Scan `~/.flow/workspaces/`
2. For each directory with a `state.yaml`, extract metadata
3. Print table

**Output:**
```
NAME           DESCRIPTION                        REPOS   CREATED
vpc-ipv6       Add IPv6 support to VPC module     2       2h ago
webhook-fix    Fix webhook null pointer           1       3d ago
```

---

### `flow render <name>`

Create worktrees from the workspace's state file.

**Behavior:**
1. Load `~/.flow/workspaces/<name>/state.yaml`
2. For each repo in `spec.repos`:
   - Ensure bare clone exists in `~/.flow/repos/`
   - Create worktree at specified path with specified branch
3. Print summary

**Output:**
```
üì¶ Rendering workspace: vpc-ipv6

  [1/2] github.com/cloudposse/atmos
        ‚îî‚îÄ‚îÄ Worktree: ./atmos (feat/ipv6-support) ‚úì

  [2/2] github.com/cloudposse/docs
        ‚îî‚îÄ‚îÄ Worktree: ./docs (feat/ipv6-support) ‚úì

‚úÖ Workspace ready

  flow exec vpc-ipv6 -- cursor .   # Open in editor
```

---

### `flow state <name>`

Open the workspace's state file in an editor.

**Behavior:**
1. Locate state file at `~/.flow/workspaces/<name>/state.yaml`
2. Open in `$EDITOR`, or `vim` if not set

**Example:**
```bash
flow state vpc-ipv6    # Opens ~/.flow/workspaces/vpc-ipv6/state.yaml in vim
```

---

### `flow exec <name> -- <cmd>`

Run a command from the workspace directory.

**Behavior:**
1. Locate workspace at `~/.flow/workspaces/<name>/`
2. Change to that directory
3. Execute the command after `--`

**Examples:**
```bash
flow exec vpc-ipv6 -- claude          # Open Claude Code
flow exec vpc-ipv6 -- cursor .        # Open Cursor
flow exec vpc-ipv6 -- code .          # Open VS Code
flow exec vpc-ipv6 -- git status      # Run git status
flow exec vpc-ipv6 -- ls -la          # List files
```

---

### `flow delete <name>`

Delete a workspace and its worktrees.

**Behavior:**
1. Locate workspace at `~/.flow/workspaces/<name>/`
2. Parse state file to identify worktrees
3. Prompt for confirmation (unless `--force`)
4. Remove each worktree (`git worktree remove`)
5. Delete workspace directory
6. Print success

**Output:**
```
‚ö†Ô∏è  Delete workspace 'vpc-ipv6'?
    This will remove:
    - ./atmos (worktree)
    - ./docs (worktree)
    - ~/.flow/workspaces/vpc-ipv6/

Confirm? [y/N] y

‚úÖ Deleted workspace: vpc-ipv6
```

**Flags:**
- `--force, -f` ‚Äî Skip confirmation

**Note:** Bare clones in `~/.flow/repos/` are kept (cached for future workspaces).

---

## State File Format

```yaml
apiVersion: flow/v1
kind: State
metadata:
  name: string           # Required. Workspace identifier.
  description: string    # Required. Human-readable description.
  created: string        # Required. ISO 8601 timestamp.

spec:
  repos:                 # Required. List of repos.
    - url: string        # Required. e.g., github.com/org/repo
      branch: string     # Required. Branch to checkout.
      path: string       # Required. Relative path for worktree.
```

**Example:**
```yaml
apiVersion: flow/v1
kind: State
metadata:
  name: vpc-ipv6
  description: "Add IPv6 support to VPC module"
  created: 2026-02-18T19:30:00Z

spec:
  repos:
    - url: github.com/cloudposse/atmos
      branch: feat/ipv6-support
      path: ./atmos
      
    - url: github.com/cloudposse/docs
      branch: feat/ipv6-support
      path: ./docs
```

---

## Directory Structure

```
~/.flow/
‚îú‚îÄ‚îÄ repos/                       # Bare clone cache
‚îÇ   ‚îî‚îÄ‚îÄ github.com/
‚îÇ       ‚îî‚îÄ‚îÄ org/
‚îÇ           ‚îî‚îÄ‚îÄ repo.git
‚îî‚îÄ‚îÄ workspaces/
    ‚îî‚îÄ‚îÄ <workspace-name>/
        ‚îú‚îÄ‚îÄ state.yaml           # Workspace state
        ‚îú‚îÄ‚îÄ <repo-a>/            # Worktree (created by render)
        ‚îî‚îÄ‚îÄ <repo-b>/            # Worktree
```

---

## Example Workflow

```bash
# Create a new workspace
flow init
# ‚Üí Creates ~/.flow/workspaces/calm-delta/ with empty state

# Add repos to the state file
flow state calm-delta

# Render the workspace (create worktrees)
flow render calm-delta

# Open in your editor
flow exec calm-delta -- cursor .

# See all workspaces
flow list

# Clean up when done
flow delete calm-delta
```

---

## Technical Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Language | Go | Single binary, fast, good CLI ecosystem |
| CLI framework | `spf13/cobra` | Standard for Go CLIs |
| Prompts | `charmbracelet/huh` | Modern UX |
| YAML parsing | `gopkg.in/yaml.v3` | Standard |
| Git operations | Shell out to `git` | Reliable |
| Default editor | `$EDITOR` or `vim` | Unix convention |

---

## Out of Scope (MVP)

| Feature | Planned For |
|---------|-------------|
| `flow prompt` (AI-driven state population) | v0.2 ([003-prompt.md](./003-prompt.md)) |
| Shared skills/symlinks | v0.3 |
| Workspace templates | v0.4 |
| TUI dashboard | v0.5 |
| External integrations | Future |

---

## Acceptance Criteria

- [ ] `flow init` creates workspace directory and valid empty state.yaml
- [ ] `flow init my-name` creates workspace with the given name
- [ ] `flow list` shows all workspaces with name, description, repo count, age
- [ ] `flow render <name>` clones repos (if needed) and creates worktrees
- [ ] `flow state <name>` opens state file in editor
- [ ] `flow exec <name> -- <cmd>` runs command from workspace directory
- [ ] `flow delete <name>` removes worktrees and workspace directory
- [ ] All commands work from any directory
- [ ] Works on macOS
