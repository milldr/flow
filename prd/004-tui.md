# PRD-004: TUI Overhaul

**Depends on:** [002-mvp.md](./002-mvp.md)

## Summary

Replace emoji prefixes, `text/tabwriter` tables, and synchronous `fmt.Printf` progress with lipgloss-styled text glyphs, `lipgloss/table` styled tables, and bubbletea spinners. The goal is polished, professional terminal output that degrades gracefully in non-TTY environments (CI, pipes).

## Motivation

The MVP used emoji prefixes (`‚úÖ`, `‚ö†Ô∏è`, `‚ùå`, `üì¶`) which render inconsistently across terminals and font configurations. The `text/tabwriter` table lacks visual structure. Long-running operations (`render`, `init`, `delete`) block with no feedback beyond sequential print statements.

## Changes

### Styled glyphs

Replace emoji prefixes with bold, colored text glyphs:

| Before | After | Color |
|--------|-------|-------|
| `‚úÖ` | `‚úì` (bold) | Green (ANSI 2) |
| `‚ö†Ô∏è` | `!` (bold) | Yellow (ANSI 3) |
| `‚ùå` | `‚úó` (bold) | Red (ANSI 1) |
| `üì¶` | `‚óè` (bold) | Blue (ANSI 4) |

### Styled table

Replace `text/tabwriter` in `flow list` with `lipgloss/table`:

- No borders (clean, minimal appearance)
- Bold blue headers
- Cell padding for readability

**Output:**
```
  ID             NAME       DESCRIPTION                     REPOS   CREATED
  calm-delta     vpc-ipv6   Add IPv6 support to VPC         2       2h ago
  warm-river     webhook    Fix webhook null pointer         1       3d ago
```

### Spinners for long-running operations

Add bubbletea spinner to `flow render`, `flow init`, and `flow delete`:

- Animated dot spinner (blue) with title text
- Progress lines reported by the operation appear indented below the spinner
- Spinner clears on completion, replaced by success/error output
- Ctrl+C cancels gracefully

**Example (`flow render`):**
```
‚£æ Rendering workspace: vpc-ipv6
  [1/2] Cloning github.com/cloudposse/atmos
  [2/2] Creating worktree ./docs (feat/ipv6-support)
```

After completion:
```
‚úì Workspace ready

  flow exec vpc-ipv6 -- cursor .   # Open in editor
```

### Stderr for errors

`Error()` and the new `Errorf()` write to stderr instead of stdout. Root command error handling uses `ui.Errorf` instead of raw `fmt.Fprintf(os.Stderr, ...)`.

## Non-TTY / CI Handling

| Component | TTY behavior | Non-TTY behavior |
|-----------|-------------|-----------------|
| Spinners | Animated bubbletea program | Plain `ui.Info` + `ui.Printf` (no animation) |
| Table | Styled borders and colors | Plain ASCII (lipgloss strips ANSI automatically) |
| Glyphs | Bold + colored | Plain text (lipgloss respects `NO_COLOR`) |

TTY detection uses `go-isatty` on `os.Stdout`. The `NO_COLOR` environment variable disables all color output.

## Dependencies

| Package | Version | Purpose |
|---------|---------|---------|
| `charmbracelet/bubbletea` | v1.3.6 | Spinner TUI program |
| `charmbracelet/bubbles` | v0.21.1-dev | Spinner widget |
| `charmbracelet/lipgloss` | v1.1.0 | Styling (existing) |
| `charmbracelet/lipgloss/table` | (subpackage) | Styled tables |
| `mattn/go-isatty` | v0.0.20 | TTY detection |

All were already indirect dependencies via `charmbracelet/huh`. This change promotes them to direct.

## Files

| File | Action |
|------|--------|
| `internal/ui/output.go` | Modified ‚Äî styled glyphs, stderr errors, `Errorf()` |
| `internal/ui/spinner.go` | Created ‚Äî bubbletea spinner, `RunWithSpinner()` |
| `internal/ui/table.go` | Created ‚Äî `Table()` wrapper |
| `internal/ui/spinner_test.go` | Created ‚Äî unit tests |
| `internal/cmd/render.go` | Modified ‚Äî uses `RunWithSpinner` |
| `internal/cmd/init.go` | Modified ‚Äî uses `RunWithSpinner` |
| `internal/cmd/delete.go` | Modified ‚Äî uses `RunWithSpinner` |
| `internal/cmd/list.go` | Modified ‚Äî uses `ui.Table` |
| `internal/cmd/root.go` | Modified ‚Äî uses `ui.Errorf` |

## Acceptance Criteria

- [x] Emoji prefixes replaced with styled text glyphs
- [x] `flow list` renders a bordered, styled table
- [x] `flow render` shows animated spinner with per-repo progress
- [x] `flow init` shows spinner during workspace creation
- [x] `flow delete` shows spinner during deletion
- [x] Errors write to stderr
- [x] Non-TTY mode falls back to plain text (no escape sequences)
- [x] `NO_COLOR=1` disables color output
- [x] `make build`, `make lint`, `make test` all pass
